<!DOCTYPE html>
<html lang= "en-us"><head>
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <link rel="manifest" href="/img/site.webmanifest">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="referrer" content="always">
	<meta name="description" content="A couple of days ago, I wanted to see all the requests a new app I had installed
was making. After firing up mitmproxy to proxy requests coming in from my android
device, I quickly realized that the application in question had implemented SSL
certificate pinning.
Many applications implement certificate pinning as an extra security layer
to protect their users from man-in-the-middle attacks. Certificate pinning allows
app developers to specify a list of certificates and ertificate authorities as valid
thus bypassing Android&rsquo;s default certificate store for validation. It also has
the added advantage of preventing snoopers from seeing requests made to certain
private APIs without decrypting/ reverse engineering the application. ">
	<link rel="canonical" href="http://retornam.com/2020/07/reversing-pinned-android-certificates/">
	<meta property="og:url" content="http://retornam.com/2020/07/reversing-pinned-android-certificates/">
  <meta property="og:site_name" content="Raymond Etornam">
  <meta property="og:title" content="Reversing Pinned Android Certificates">
  <meta property="og:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android’s default certificate store for validation. It also has the added advantage of preventing snoopers from seeing requests made to certain private APIs without decrypting/ reverse engineering the application.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-07-07T17:49:13-07:00">
    <meta property="article:modified_time" content="2020-07-07T17:49:13-07:00">

	
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Reversing Pinned Android Certificates">
  <meta name="twitter:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android’s default certificate store for validation. It also has the added advantage of preventing snoopers from seeing requests made to certain private APIs without decrypting/ reverse engineering the application.">

	<link rel="icon" href="/img/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/css/gruvbox-dark.css">
	<link rel="stylesheet" type="text/css" href="/css/hack.css">
	<title>
		  Reversing Pinned Android Certificates |   Raymond Etornam
	</title>
</head>


<body class="snow hack gruvbox-dark">
    	<div class="container"><header>
	<p>
		<a href="/">Raymond Etornam</a>
		 - 
		<a href="/posts">Posts</a>
		 - 
		<a href="/about">About</a>
	</p>
</header><div class="newframe">
    			<main>
  <h1> Reversing Pinned Android Certificates</h1>
  <p><time> July 7, 2020</time><p>
 <p>A couple of days ago, I wanted to see all the requests a new app I had installed
was making. After firing up mitmproxy to proxy requests coming in from my android
device, I quickly realized that the application in question had implemented SSL
certificate pinning.</p>
<p>Many applications implement certificate pinning as an extra security layer
to protect their users from man-in-the-middle attacks. Certificate pinning allows
app developers to specify a list of certificates and ertificate authorities as valid
thus bypassing Android&rsquo;s default certificate store for validation. It also has
the added advantage of preventing snoopers from seeing requests made to certain
private APIs without decrypting/ reverse engineering the application.</p>
<p>There are many online tutorials out there on how to reverse engineer android
applications to remove the pinned certificate, many of them however go deeper
into steps to remove certificate pinning instead of following the simple steps
below.</p>
<p>Install the following tools, if you dont have them already.</p>
<ul>
<li><a href="https://github.com/iBotPeaches/Apktool/tags">apktool</a></li>
<li><a href="https://developer.android.com/studio/command-line/adb">adb</a></li>
<li><a href="https://github.com/patrickfav/uber-apk-signer/tags">uber-apk-signer</a></li>
</ul>
<p>Copy the apk from your phone to a directory on your computer with adb</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>adb pull /data/app/com.example.example/example.apk example.apk
</span></span></code></pre></div><p>Decode the apk to the current directory using apktool</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>apktool d example<span style="color:#f92672">.</span>apk
</span></span></code></pre></div><p>Edit the application element in AndroidManifest.xml to include
android:networkSecurityConfig=&quot;@xml/network_security_config</p>
<p>Create or edit the file with path res/xml/network_security_config.xml to look
as follows</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span><span style="display:flex;"><span>&lt;network-security-config&gt;
</span></span><span style="display:flex;"><span>    &lt;base-config&gt;
</span></span><span style="display:flex;"><span>        &lt;trust-anchors&gt;
</span></span><span style="display:flex;"><span>            &lt;certificates src=&#34;system&#34; /&gt;
</span></span><span style="display:flex;"><span>            &lt;certificates src=&#34;user&#34; /&gt;
</span></span><span style="display:flex;"><span>        &lt;/trust-anchors&gt;
</span></span><span style="display:flex;"><span>    &lt;/base-config&gt;
</span></span><span style="display:flex;"><span>&lt;/network-security-config&gt;
</span></span></code></pre></div><p>Rebuild the apk to include the changes you made</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>apktool b app <span style="color:#f92672">-</span>o example<span style="color:#f92672">-</span>patched<span style="color:#f92672">.</span>jar
</span></span></code></pre></div><p>Sign the newly patched apk with the uber-apk-signer, you will not be able
to install the new apk on your device without signing it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>java -jar uber-apk-signer-1.1.0.jar --apks example-patched.apk
</span></span></code></pre></div><p>Install the signed apk on your device</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>adb install example-signed.apk
</span></span></code></pre></div><p>Configure your device to use your mitmproxy of choice and proxy away.</p>


    			</main>
    		</div></div>
        
    </body>
</html>
