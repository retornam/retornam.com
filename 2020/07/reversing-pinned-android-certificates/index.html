<!DOCTYPE html>
<html><head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Reversing Pinned Android Certificates - Raymond Etornam</title><meta name="viewport" content="width=device-width, initial-scale=1">

	<meta property="og:description" content="" />
	<meta name="twitter:description" content="" />
	<meta name="description" content="retornam.com" />
	<meta name="description" content="" />

	<meta property="og:title" content="Reversing Pinned Android Certificates | Raymond Etornam" />
	<meta name="twitter:title" content="Reversing Pinned Android Certificates | Raymond Etornam" />

	<meta property="og:image" content=""/>
	<meta itemprop="name" content="Reversing Pinned Android Certificates | Raymond Etornam" />
	<meta name="application-name" content="Reversing Pinned Android Certificates | Raymond Etornam" />
	<meta property="og:site_name" content="" />
	<meta property="og:title" content="Reversing Pinned Android Certificates" />
<meta property="og:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android&rsquo;s default certificate store for validation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://retornam.com/2020/07/reversing-pinned-android-certificates/" />
<meta property="article:published_time" content="2020-07-07T17:49:13-07:00" />
<meta property="article:modified_time" content="2020-07-07T17:49:13-07:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing Pinned Android Certificates"/>
<meta name="twitter:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android&rsquo;s default certificate store for validation."/>

	<link href="http://retornam.comcss/fonts.css" rel="stylesheet">
	
	<link rel="stylesheet" type="text/css" media="screen" href="http://retornam.comcss/main.css" /><link rel="stylesheet" type="text/css" href="http://retornam.comcss/dark.css"  />
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://retornam.com">Raymond Etornam</a>
	</div>
	<nav>
		
		<a href="/posts">Archives</a>
		
		<a href="/about">About</a>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Reversing Pinned Android Certificates</h1>
			<div class="meta">Posted on Jul 7, 2020</div>
		</div>
		

		<section class="body">
			<p>A couple of days ago, I wanted to see all the requests a new app I had installed
was making. After firing up mitmproxy to proxy requests coming in from my android
device, I quickly realized that the application in question had implemented SSL
certificate pinning.</p>
<p>Many applications implement certificate pinning as an extra security layer
to protect their users from man-in-the-middle attacks. Certificate pinning allows
app developers to specify a list of certificates and ertificate authorities as valid
thus bypassing Android&rsquo;s default certificate store for validation. It also has
the added advantage of preventing snoopers from seeing requests made to certain
private APIs without decrypting/ reverse engineering the application.</p>
<p>There are many online tutorials out there on how to reverse engineer android
applications to remove the pinned certificate, many of them however go deeper
into steps to remove certificate pinning instead of following the simple steps
below.</p>
<p>Install the following tools, if you dont have them already.</p>
<ul>
<li><a href="https://github.com/iBotPeaches/Apktool/tags">apktool</a></li>
<li><a href="https://developer.android.com/studio/command-line/adb">adb</a></li>
<li><a href="https://github.com/patrickfav/uber-apk-signer/tags">uber-apk-signer</a></li>
</ul>
<p>Copy the apk from your phone to a directory on your computer with adb</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">adb pull /data/app/com.example.example/example.apk example.apk
</code></pre></div><p>Decode the apk to the current directory using apktool</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">apktool d example.apk
</code></pre></div><p>Edit the application element in AndroidManifest.xml to include
android:networkSecurityConfig=&quot;@xml/network_security_config</p>
<p>Create or edit the file with path res/xml/network_security_config.xml to look
as follows</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;network-security-config&gt;
    &lt;base-config&gt;
        &lt;trust-anchors&gt;
            &lt;certificates src=&#34;system&#34; /&gt;
            &lt;certificates src=&#34;user&#34; /&gt;
        &lt;/trust-anchors&gt;
    &lt;/base-config&gt;
&lt;/network-security-config&gt;
</code></pre></div><p>Rebuild the apk to include the changes you made</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">apktool b app -o example-patched.jar
</code></pre></div><p>Sign the newly patched apk with the uber-apk-signer, you will not be able
to install the new apk on your device without signing it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">java -jar uber-apk-signer-1.1.0.jar --apks example-patched.apk
</code></pre></div><p>Install the signed apk on your device</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">adb install example-signed.apk
</code></pre></div><p>Configure your device to use your mitmproxy of choice and proxy away.</p>

		</section>

		<div class="post-tags">
			
			
			
		</div>
	</article>
</main>
<footer>
<hr>❤️
	2020  retornam.com   
</footer>


</div>
    </body>
</html>
