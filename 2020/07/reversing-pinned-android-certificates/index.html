<!DOCTYPE html>
<html lang= "en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta name="description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android&rsquo;s default certificate store for validation. ">
	<link rel="canonical" href="http://retornam.com/2020/07/reversing-pinned-android-certificates/">
	<meta property="og:title" content="Reversing Pinned Android Certificates" />
<meta property="og:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android&rsquo;s default certificate store for validation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://retornam.com/2020/07/reversing-pinned-android-certificates/" />
<meta property="article:published_time" content="2020-07-07T17:49:13-07:00" />
<meta property="article:modified_time" content="2020-07-07T17:49:13-07:00" />

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing Pinned Android Certificates"/>
<meta name="twitter:description" content="A couple of days ago, I wanted to see all the requests a new app I had installed was making. After firing up mitmproxy to proxy requests coming in from my android device, I quickly realized that the application in question had implemented SSL certificate pinning.
Many applications implement certificate pinning as an extra security layer to protect their users from man-in-the-middle attacks. Certificate pinning allows app developers to specify a list of certificates and ertificate authorities as valid thus bypassing Android&rsquo;s default certificate store for validation."/>

	<link rel="icon" href="/img/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/css/gruvbox-dark.css">
	<link rel="stylesheet" type="text/css" href="/css/hack.css">
	<title>
		  Reversing Pinned Android Certificates |   retornam.com
	</title>
</head>


<body class="snow hack gruvbox-dark">
    	<div class="container"><header>
	<p>
		<a href="/">Raymond Etornam</a>
		 - 
		<a href="/posts">Posts</a>
		 - 
		<a href="/about">About</a>
	</p>
</header><div class="newframe">
    			<main>
  <h1> Reversing Pinned Android Certificates</h1>
  <p><time> July 7, 2020</time><p>
 <p>A couple of days ago, I wanted to see all the requests a new app I had installed
was making. After firing up mitmproxy to proxy requests coming in from my android
device, I quickly realized that the application in question had implemented SSL
certificate pinning.</p>
<p>Many applications implement certificate pinning as an extra security layer
to protect their users from man-in-the-middle attacks. Certificate pinning allows
app developers to specify a list of certificates and ertificate authorities as valid
thus bypassing Android&rsquo;s default certificate store for validation. It also has
the added advantage of preventing snoopers from seeing requests made to certain
private APIs without decrypting/ reverse engineering the application.</p>
<p>There are many online tutorials out there on how to reverse engineer android
applications to remove the pinned certificate, many of them however go deeper
into steps to remove certificate pinning instead of following the simple steps
below.</p>
<p>Install the following tools, if you dont have them already.</p>
<ul>
<li><a href="https://github.com/iBotPeaches/Apktool/tags">apktool</a></li>
<li><a href="https://developer.android.com/studio/command-line/adb">adb</a></li>
<li><a href="https://github.com/patrickfav/uber-apk-signer/tags">uber-apk-signer</a></li>
</ul>
<p>Copy the apk from your phone to a directory on your computer with adb</p>
<pre><code>adb pull /data/app/com.example.example/example.apk example.apk
</code></pre><p>Decode the apk to the current directory using apktool</p>
<pre><code>apktool d example.apk
</code></pre><p>Edit the application element in AndroidManifest.xml to include
android:networkSecurityConfig=&quot;@xml/network_security_config</p>
<p>Create or edit the file with path res/xml/network_security_config.xml to look
as follows</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;network-security-config&gt;
    &lt;base-config&gt;
        &lt;trust-anchors&gt;
            &lt;certificates src=&quot;system&quot; /&gt;
            &lt;certificates src=&quot;user&quot; /&gt;
        &lt;/trust-anchors&gt;
    &lt;/base-config&gt;
&lt;/network-security-config&gt;
</code></pre><p>Rebuild the apk to include the changes you made</p>
<pre><code>apktool b app -o example-patched.jar
</code></pre><p>Sign the newly patched apk with the uber-apk-signer, you will not be able
to install the new apk on your device without signing it.</p>
<pre><code>java -jar uber-apk-signer-1.1.0.jar --apks example-patched.apk
</code></pre><p>Install the signed apk on your device</p>
<pre><code>adb install example-signed.apk
</code></pre><p>Configure your device to use your mitmproxy of choice and proxy away.</p>


    			</main>
    		</div></div>
        
    </body>
</html>
